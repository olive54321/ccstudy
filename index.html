<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>English Speaking Practice for You ğŸ’•</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      max-width: 700px;
      margin: 40px auto;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 12px;
      background: #fafafa;
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
    }
    .sub {
      text-align: center;
      color: #666;
      font-size: 14px;
      margin-bottom: 20px;
    }
    label {
      font-size: 14px;
      margin-right: 8px;
    }
    select {
      padding: 4px 8px;
    }
    button {
      margin: 5px;
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: white;
    }
    button:hover {
      background: #f0f0f0;
    }
    #target, #result, #score, #hint {
      margin-top: 15px;
      padding: 10px;
      border-radius: 8px;
      background: #ffffff;
      box-shadow: 0 0 3px rgba(0,0,0,0.05);
    }
    #target strong {
      font-size: 18px;
    }
    #log {
      margin-top: 10px;
      color: #666;
      font-size: 13px;
    }
    .tag {
      display: inline-block;
      background: #eee;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px;
      margin-left: 4px;
    }
  </style>
</head>
<body>
  <h1>English Speaking Practice ğŸ’¬</h1>
  <div class="sub">for my favorite girl ğŸ’–</div>

  <!-- åœºæ™¯é€‰æ‹©ï¼šæ—¥å¸¸ / æ—…æ¸¸ / ç”œç”œæ‹çˆ± -->
  <div>
    <label for="scene">Choose a topic:</label>
    <select id="scene">
      <option value="daily">Daily life</option>
      <option value="travel">Travel</option>
      <option value="sweet">Sweet</option>
    </select>
    <span class="tag">å…ˆé€‰ä¸€ä¸ªä¸»é¢˜ï¼Œå†ç‚¹ Next</span>
  </div>

  <!-- æ˜¾ç¤ºå½“å‰è¦ç»ƒçš„å¥å­ + ä¸­æ–‡ç¿»è¯‘ -->
  <div id="target">
    Click â€œNext sentenceâ€ to start.
  </div>

  <!-- æŒ‰é’®åŒº -->
  <div style="margin-top: 15px;">
    <button id="btnNext">Next sentence</button>
    <button id="btnSpeak">Computer read</button>
    <button id="btnRecord">I will speak</button>
  </div>

  <!-- è¯†åˆ«ç»“æœ -->
  <div id="result">Recognized text will appear here.</div>
  <!-- åˆ†æ•° + é¼“åŠ± -->
  <div id="score">Score will appear here.</div>
  <!-- å°æç¤º -->
  <div id="hint">Tip: Use Google Chrome, and allow microphone when the browser asks.</div>
  <!-- æ—¥å¿—çŠ¶æ€ -->
  <div id="log"></div>

  <script>
    // ===== 1. å¥å­åº“ï¼šå¯ä»¥æ”¹æˆä½ ä»¬è‡ªå·±çš„å¥å­ =====
    // æ¯ä¸ªå¥å­ï¼šenglish è‹±æ–‡, chinese ä¸­æ–‡ç¿»è¯‘
    const data = {
      daily: [
        { english: "How are you today?", chinese: "ä½ ä»Šå¤©æ€ä¹ˆæ ·ï¼Ÿ" },
        { english: "I just finished my work.", chinese: "æˆ‘åˆšåˆšä¸‹ç­/å®Œæˆå·¥ä½œã€‚" },
        { english: "I am learning English every day.", chinese: "æˆ‘æ¯å¤©éƒ½åœ¨å­¦è‹±è¯­ã€‚" },
        { english: "This is not perfect, but I am getting better.", chinese: "è™½ç„¶ä¸å®Œç¾ï¼Œä½†æˆ‘åœ¨æ…¢æ…¢è¿›æ­¥ã€‚" }
      ],
      travel: [
        { english: "Where is the nearest subway station?", chinese: "æœ€è¿‘çš„åœ°é“ç«™åœ¨å“ªé‡Œï¼Ÿ" },
        { english: "Could you recommend a good restaurant nearby?", chinese: "ä½ å¯ä»¥æ¨èé™„è¿‘å¥½åƒçš„é¤å…å—ï¼Ÿ" },
        { english: "How much is a ticket to the airport?", chinese: "å»æœºåœºçš„è½¦ç¥¨å¤šå°‘é’±ï¼Ÿ" },
        { english: "I would like to book a table for two.", chinese: "æˆ‘æƒ³è®¢ä¸€å¼ ä¸¤ä¸ªäººçš„é¤æ¡Œã€‚" }
      ],
      sweet: [
        { english: "I am proud of you.", chinese: "æˆ‘çœŸçš„ä¸ºä½ æ„Ÿåˆ°éª„å‚²ã€‚" },
        { english: "I miss you every single day.", chinese: "æˆ‘æ¯å¤©éƒ½åœ¨æƒ³ä½ ã€‚" },
        { english: "You make my life so much better.", chinese: "å› ä¸ºä½ ï¼Œæˆ‘çš„ç”Ÿæ´»å˜å¾—å¥½å¤šäº†ã€‚" },
        { english: "No matter what happens, I am always on your side.", chinese: "ä¸ç®¡å‘ç”Ÿä»€ä¹ˆï¼Œæˆ‘éƒ½ç«™åœ¨ä½ è¿™è¾¹ã€‚" }
      ]
    };

    // å½“å‰åœºæ™¯çš„å¥å­åˆ—è¡¨
    let currentList = data.daily;
    // å½“å‰è¿™ä¸€æ¬¡è¦ç»ƒçš„å¥å­
    let currentSentence = null;

    // ===== 2. è·å–é¡µé¢ä¸Šçš„å…ƒç´  =====
    const sceneSelect = document.getElementById("scene");
    const targetDiv = document.getElementById("target");
    const resultDiv = document.getElementById("result");
    const scoreDiv = document.getElementById("score");
    const hintDiv = document.getElementById("hint");
    const logDiv = document.getElementById("log");

    // ===== 3. åœºæ™¯æ”¹å˜æ—¶ï¼Œåˆ‡æ¢å¥å­åˆ—è¡¨ =====
    sceneSelect.onchange = function () {
      const value = sceneSelect.value;
      if (value === "daily") currentList = data.daily;
      else if (value === "travel") currentList = data.travel;
      else if (value === "sweet") currentList = data.sweet;

      // åˆ‡æ¢åœºæ™¯åï¼Œæ¸…ç©ºå½“å‰æ˜¾ç¤º
      currentSentence = null;
      targetDiv.innerHTML = "Click â€œNext sentenceâ€ to start.";
      resultDiv.textContent = "Recognized text will appear here.";
      scoreDiv.textContent = "Score will appear here.";
      logDiv.textContent = "";
    };

    // ===== 4. ç®€å•ç›¸ä¼¼åº¦è®¡ç®—ï¼šæŒ‰å•è¯é‡åˆæ•°é‡ç®—ç™¾åˆ†æ¯” =====
    function calcSimilarity(a, b) {
      if (!a || !b) return 0;

      // å…¨éƒ¨è½¬å°å†™ï¼Œå»æ‰æ ‡ç‚¹ï¼Œåªä¿ç•™å­—æ¯å’Œç©ºæ ¼ï¼Œå†æŒ‰ç©ºæ ¼æ‹†æˆå•è¯
      const wa = a.toLowerCase().replace(/[^a-z\s]/g, "").split(/\s+/).filter(Boolean);
      const wb = b.toLowerCase().replace(/[^a-z\s]/g, "").split(/\s+/).filter(Boolean);

      if (wa.length === 0 || wb.length === 0) return 0;

      let match = 0;
      wa.forEach(word => {
        if (wb.includes(word)) match++;
      });

      return Math.round((match / Math.max(wa.length, wb.length)) * 100);
    }

    // ===== 5. â€œNext sentenceâ€ æŒ‰é’®ï¼šéšæœºæŒ‘ä¸€å¥å½“å‰åœºæ™¯çš„å¥å­ =====
    document.getElementById("btnNext").onclick = function () {
      const idx = Math.floor(Math.random() * currentList.length);
      currentSentence = currentList[idx];

      targetDiv.innerHTML =
        "<div>English:</div>" +
        "<strong>" + currentSentence.english + "</strong>" +
        "<div style='margin-top:8px;color:#555;'>ä¸­æ–‡ï¼š " + currentSentence.chinese + "</div>";

      resultDiv.textContent = "Recognized text will appear here.";
      scoreDiv.textContent = "Score will appear here.";
      logDiv.textContent = "";
    };

    // ===== 6. â€œComputer readâ€ æŒ‰é’®ï¼šç”¨æµè§ˆå™¨ TTS è¯»ä¸€å¥ =====
    document.getElementById("btnSpeak").onclick = function () {
      if (!currentSentence) {
        logDiv.textContent = "Please click 'Next sentence' first.";
        return;
      }
      const utter = new SpeechSynthesisUtterance(currentSentence.english);
      utter.lang = "en-US"; // å¯ä»¥å›ºå®šä¸ºç¾éŸ³
      window.speechSynthesis.speak(utter);
    };

    // ===== 7. â€œI will speakâ€ æŒ‰é’®ï¼šå¼€å§‹å½•éŸ³ + è¯­éŸ³è¯†åˆ« =====
    document.getElementById("btnRecord").onclick = function () {
      // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒè¯­éŸ³è¯†åˆ«
      if (!("webkitSpeechRecognition" in window) && !("SpeechRecognition" in window)) {
        logDiv.textContent = "Speech recognition not supported. Please use Google Chrome.";
        return;
      }

      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      const recognition = new SR();
      recognition.lang = "en-US";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      logDiv.textContent = "Listening... Please speak.";
      hintDiv.textContent = "If nothing happens, check if you allowed microphone access.";

      // è¯†åˆ«æˆåŠŸ
      recognition.onresult = (event) => {
        const text = event.results[0][0].transcript;
        resultDiv.textContent = "You said: " + text;

        if (currentSentence) {
          const score = calcSimilarity(text, currentSentence.english);
          scoreDiv.textContent = "Similarity: " + score + "%";

          if (score > 85) {
            scoreDiv.textContent += "  ğŸŒŸ Amazing!";
          } else if (score > 60) {
            scoreDiv.textContent += "  ğŸ™‚ Pretty good, try again!";
          } else {
            scoreDiv.textContent += "  ğŸ’ª Keep going, you are learning!";
          }
        }
        logDiv.textContent = "Done.";
      };

      // å‡ºé”™æƒ…å†µ
      recognition.onerror = (event) => {
        logDiv.textContent = "Error: " + event.error;
      };

      // ç»“æŸï¼ˆæ— è®ºæˆåŠŸå¤±è´¥ï¼‰
      recognition.onend = () => {
        if (!logDiv.textContent.startsWith("Error") && logDiv.textContent !== "Done.") {
          logDiv.textContent = "Stopped. You can click 'I will speak' again.";
        }
      };

      recognition.start();
    };
  </script>
</body>
</html>
