<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>English Speaking Practice</title>
<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;
  max-width:900px;margin:30px auto;padding:20px;background:#fafafa;color:#111;
}
.card{background:#fff;border-radius:14px;padding:16px;margin-bottom:14px;
box-shadow:0 2px 10px rgba(0,0,0,.05)}
h1{text-align:center;margin-bottom:6px}
.sub{text-align:center;color:#666;margin-bottom:14px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
button,select,input{
  padding:8px 12px;border-radius:10px;border:1px solid #ccc;background:#fff;cursor:pointer
}
button:hover{background:#f3f3f3}
#english{font-size:20px;font-weight:700;line-height:1.4}
#chinese{margin-top:6px;color:#444}
.progress{height:10px;background:#eee;border-radius:999px;overflow:hidden}
.bar{height:10px;background:#111;width:0%}
.list{max-height:200px;overflow:auto;border:1px solid #eee;border-radius:10px;padding:8px}
.item{border:1px solid #eee;border-radius:8px;padding:8px;margin:6px 0;
display:flex;justify-content:space-between;gap:10px}
.small{font-size:12px;color:#666}
.good{color:#0a7}
.warn{color:#b60}
.bad{color:#c33}
</style>
</head>
<body>

<h1>English Speaking Practice</h1>
<div class="sub">700 TOEFL-level sentences Â· Progress saved</div>

<div class="card">
  <div class="row">
    <select id="scene">
      <option value="daily">Daily</option>
      <option value="travel">Travel</option>
      <option value="sweet">Sweet</option>
      <option value="shopping">Shopping</option>
      <option value="housing">Housing</option>
      <option value="dining">Dining</option>
      <option value="study">Study</option>
    </select>

    <select id="mode">
      <option value="all">All</option>
      <option value="fav">Favorites</option>
      <option value="wrong">Wrong-book</option>
    </select>

    <span class="small">Wrong if &lt;</span>
    <input id="threshold" type="number" value="70" style="width:60px"/>
  </div>

  <div style="margin-top:10px" class="progress">
    <div id="bar" class="bar"></div>
  </div>
  <div id="progressText" class="small"></div>
</div>

<div class="card">
  <div id="english">Loadingâ€¦</div>
  <div id="chinese"></div>

  <div class="row" style="margin-top:12px">
    <button id="prev">â—€ Prev</button>
    <button id="next">Next â–¶</button>
    <button id="rand">ğŸ² Random</button>
    <button id="speak">ğŸ”Š Read</button>
    <button id="record">ğŸ¤ Speak</button>
    <button id="fav">â­</button>
    <button id="wrong">ğŸ“</button>
  </div>

  <div id="result" class="small"></div>
  <div id="score"></div>
</div>

<div class="card">
  <div class="row">
    <button id="tabFav">â­ Favorites</button>
    <button id="tabWrong">ğŸ“ Wrong-book</button>
  </div>
  <div id="list" class="list"></div>
</div>

<script>
const $ = id => document.getElementById(id);
let topic="daily",mode="all",threshold=70;
let full=[],active=[],idx=0;
let fav=new Set(),wrong=new Set();

function sid(s){return s.en.slice(0,80).toLowerCase()}
function save(){
  localStorage.setItem(topic+"_i",idx);
  localStorage.setItem(topic+"_f",[...fav]);
  localStorage.setItem(topic+"_w",[...wrong]);
}
function load(){
  idx=parseInt(localStorage.getItem(topic+"_i")||0);
  fav=new Set((localStorage.getItem(topic+"_f")||"").split(",").filter(x=>x));
  wrong=new Set((localStorage.getItem(topic+"_w")||"").split(",").filter(x=>x));
}
function rebuild(){
  if(mode==="fav") active=full.filter(s=>fav.has(sid(s)));
  else if(mode==="wrong") active=full.filter(s=>wrong.has(sid(s)));
  else active=full;
  if(idx>=active.length) idx=0;
}
function show(){
  if(!active.length){$("english").textContent="No sentences";return}
  const s=active[idx];
  $("english").textContent=s.en;
  $("chinese").textContent=s.zh||"";
  $("progressText").textContent=`${idx+1}/${active.length}`;
  $("bar").style.width=((idx+1)/active.length*100)+"%";
  save(); renderList();
}
async function loadTopic(t){
  topic=t;
  $("english").textContent="Loadingâ€¦";
  const resp=await fetch(`./data/${topic}.json`,{cache:"no-cache"});
  if(!resp.ok){
    const msg=`Fetch failed ${resp.status} ${resp.statusText}`;
    $("english").textContent=msg; throw new Error(msg);
  }
  full=await resp.json(); load(); rebuild(); show();
}

$("scene").onchange=e=>loadTopic(e.target.value);
